<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2014-01-17
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20140117" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Non-Embedded Smart Agent for Licensing - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

              
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Non-Embedded Smart Agent for Licensing</h2>
                </div>
                      </div>
        <div class="pull-right">              <div id="bannerRight">
                                                                                                <img src="images/DLO_logo.jpg"  alt="Smart Licensing"/>
                </div>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2014-01-17</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.1</li>
                      
                
                    
      
                                              
    <li class="pull-right">              <a href="http://wikicentral.cisco.com/display/ELO/Home" class="externalLink" title="DLO Engineering Home">
        DLO Engineering Home</a>
  </li>

                        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Project Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Design Considerations</a>
          </li>
                  
      <li>
    
                          <a href="design-diagrams.html" title="Design Diagrams">
          <i class="none"></i>
        Design Diagrams</a>
            </li>
                                                                                                  
      <li>
    
                          <a href="apidocs.html" title="API Docs">
          <i class="icon-chevron-down"></i>
        API Docs</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="apidocs/index.html" title="Java API">
          <i class="none"></i>
        Java API</a>
            </li>
                      
      <li>
    
                          <a href="under-construction.html" title="Ruby API">
          <i class="none"></i>
        Ruby API</a>
            </li>
                      
      <li>
    
                          <a href="under-construction.html" title="REST API">
          <i class="none"></i>
        REST API</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="dev-env.html" title="Development Environment">
          <i class="none"></i>
        Development Environment</a>
            </li>
                  
      <li>
    
                          <a href="proj-schedule.html" title="Project Schedule">
          <i class="none"></i>
        Project Schedule</a>
            </li>
                  
      <li>
    
                          <a href="dependencies.html" title="Dependencies">
          <i class="none"></i>
        Dependencies</a>
            </li>
                  
      <li>
    
                          <a href="issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                  
      <li>
    
                          <a href="project-team.html" title="Project Team">
          <i class="none"></i>
        Project Team</a>
            </li>
                  
      <li>
    
                          <a href="faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Other Information</li>
                                
      <li>
    
                          <a href="http://wikicentral.cisco.com/display/ELO/Home" class="externalLink" title="DLO Engineering Home">
          <i class="none"></i>
        DLO Engineering Home</a>
            </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2>Design Considerations<a name="Design_Considerations"></a></h2></div>
<p><br /></p>
<p>The design considerations on this page is based on the requirements listed in <b>DLO Non-Embedded Smart Agent Plan</b> document.</p>
<p><br /></p>
<div class="section">
<h3>1) OS Portability<a name="a1_OS_Portability"></a></h3></div>
<p>NESAL needs to be portable among popular Operation Systems including, but not limited to, Linux and Windows. To meet this requirement, NESAL will be implemented in JVM languages and executed on JVM at runtime environment.</p>
<p><br /></p>
<div class="section">
<h3>2) Northbound and Southbound API<a name="a2_Northbound_and_Southbound_API"></a></h3></div>
<p>NESAL has a pluggable architecture whereas it defines a set of Northbound API which provides licensing services and can be invoked by software product and client programs; and a set of Southbound API Interface for software products to provide their plug-ins implementation.</p>
<p><br /></p>
<div class="section">
<h3>3) Support Multiple Language Bindings for Northbound API<a name="a3_Support_Multiple_Language_Bindings_for_Northbound_API"></a></h3></div>
<p>NESAL needs to support multiple language bindings for the Northbound API, including API for Java, Ruby, C<u></u> and C# languages.</p>
<p>The approach that we will consider to fulfill this requirement is using Apache Thrift as middleware layer. Apache Thrift is a RPC (remote procedure call) framework developed by Facebook. It also provides multiple language bindings for both client side and server side. Cisco onePK also adopted Thrift for its middleware layer.</p>
<p>With Apache Thrift it is possible we maintain a single code base at server side while providing  multiple language bindings at client side with minimal effort.</p>
<p>The following component diagram illustrate the design using Apache Thrift:</p><img src="images/NESAL_diagram.jpg" alt="" />
<p><br /></p>
<div class="section">
<h3>4) REST API<a name="a4_REST_API"></a></h3></div>
<p>In addition to traditional language bindings, RESTful API will be provided for Northbound API to allow language-agnostic programming. The following considerations should be kept in mind:</p>
<ul>
<li>Design the API to conform to RESTful conventions.</li></ul>
<ul>
<li>Define the object model in terms of resource. A resource is a collection of information that can be identified by a URI (it's the R in URI), for example, <b>entitlement</b>.</li></ul>
<ul>
<li>Allow the Smart Agent to be packaged as WAR file and run as web application on web server.</li></ul>
<p><br /></p>
<div class="section">
<h3>5) State Machine Implementation<a name="a5_State_Machine_Implementation"></a></h3></div>
<p>In oder to keep in sync with the logic in the Embedded Smart Agent, NESAL needs to implement State Machine to determine the state of entitlements.</p>
<p>It is possible to reuse open-source implementation of State Machine Framework. The followings are some options to consider:</p>
<ul>
<li>Apache Commons SCXML - <a class="externalLink" href="http://commons.apache.org/proper/commons-scxml/">http://commons.apache.org/proper/commons-scxml/</a></li>
<li>UniMod - <a class="externalLink" href="http://unimod.sourceforge.net/fsm-framework.html">http://unimod.sourceforge.net/fsm-framework.html</a></li>
<li>Fettle - <a class="externalLink" href="http://thehiflyer.github.io/Fettle/">http://thehiflyer.github.io/Fettle/</a></li></ul>
<p><br /></p>
<div class="section">
<h3>6) Ensure API Consistency with the Embedded Agent<a name="a6_Ensure_API_Consistency_with_the_Embedded_Agent"></a></h3></div>
<p>Since NESAL will not share the same code base with the Embedded Agent, special care will be taken to ensure the API consistency between the two.</p>
<p>At this moment, the process will involve reviewing the API documents for these two side by side. In the future, automatic script should be developed for reporting the discrepancy.</p>
<p><br /></p>
<div class="section">
<h3>7) Ensure API Consistency among Multiple Language Bindings<a name="a7_Ensure_API_Consistency_among_Multiple_Language_Bindings"></a></h3></div>
<p>Since NESAL will provide multiple language bindings for the API, special care also need to be taken to ensure the API consistency among languages.</p>
<p>Again, automatic script should be considered for reporting the discrepancy in the future.</p>
<p><br /></p>
<div class="section">
<h3>8) Use of JRuby for Implementation<a name="a8_Use_of_JRuby_for_Implementation"></a></h3></div>
<p>Ruby provides a rich set of facilities for metaprogramming and reflection. Its reliance on closures and blocks make for a programming style that is both compact and powerful. Ruby shines as an agile programming language for building coding blocks, while Java is suitable for system integration. So we will use Java for the framework and JRuby for internal implementation in the development phase.</p>
<p>There are two mechanisms for integrating Java and Ruby code:</p>
<div class="section">
<h4>8.1) Generating Java Classes from Ruby Code Ahead-of-time<a name="a8.1_Generating_Java_Classes_from_Ruby_Code_Ahead-of-time"></a></h4></div>
<p>The first approach is using <b>jrubyc</b> command to generate Java source code from Ruby scripts that have classes in them. For example, a simple Ruby class:</p>
<div class="source">
<pre> class Foo
   def bar(a, b)
     puts a + b
   end
 end
</pre></div>
<p>To expose this Ruby class as a Java class, we can run &quot;jrubyc --java&quot; to produce a Java class:</p>
<div class="source">
<pre>jrubyc --javac my_foo.rb 
Generating Java class Foo to Foo.java
javac -d /ws/jrubyc_demo -cp jruby.jar:. Foo.java
</pre></div>
<div class="section">
<h4>8.2) Invoke Ruby Script from Java Code at Runtime<a name="a8.2_Invoke_Ruby_Script_from_Java_Code_at_Runtime"></a></h4></div>
<p>The second approach is using <b>Java Scripting API</b> which is a scripting language indepedent framework for using script engines from Java code. With the Java Scripting API, it is possible to write the framework in Java language and write the implementation using scripting language of choice, inclduing Ruby.</p>
<p>In the following example, we call the eval method that accepts java.io.Reader for the input source. The script read by the given reader is executed. This way it is possible to execute scripts from files, URLs and resources by wrapping the relevant input stream objects as readers.</p>
<div class="source">
<pre>import javax.script.*;
public class EvalFile {
    public static void main(String[] args) throws Exception {
        // create a script engine manager
        ScriptEngineManager factory = new ScriptEngineManager();
        // create Ruby engine
        ScriptEngine engine = factory.getEngineByName(&quot;Ruby&quot;);
        // evaluate Ruby code from given file - specified by first argument
        engine.eval(new java.io.FileReader(args[0]));
    }
}
</pre></div>
<p><br /></p>
<div class="section">
<h3>9) Enforce Plugins to Provide Implementation<a name="a9_Enforce_Plugins_to_Provide_Implementation"></a></h3></div>
<p>The Soundbound API interface can be regarded as a <b>contract</b> between the Agent and the plugins. The contract needs the implementation from the plugins. Java's <b>Interface</b> can be used to enforce such contract.</p>
<p><br /></p>
<div class="section">
<h3>10) Manageability<a name="a10_Manageability"></a></h3></div>
<p>NESAL needs to provide a way for administrator to monitor the state and status of the agent. The following option will be considered and decided before implementation:</p>
<ul>
<li><b>Web UI</b> - An embedded HTTP server that displays the management information on a Web page.</li>
<li><b>JMX</b> - <b>Java Management Extensions</b> is a Java technology that supplies tools for managing and monitoring applications.</li></ul>
<p><br /></p>
<div class="section">
<h3>11) Security - Crypto and Certificate<a name="a11_Security_-_Crypto_and_Certificate"></a></h3></div>
<p>When communicating with the Smart Licensing back-end, the Smart Agent signs all out-going messages and verify all incoming messages; as such, it needs a crypto library.  CiscoSSL, maintained by the Common Crypto engineering team, is the preferred crypto library.</p>
<p>http://wwwin-dev.cisco.com/osp/gov/ggsgeng/tsi/crypto/download/</p>
<p><br /></p>
<div class="section">
<h3>12) Security - JAR File Signing<a name="a12_Security_-_JAR_File_Signing"></a></h3></div>
<p>Another aspect of security is to maintain the integrity of the Smart Agent library code. Since there is possibility that the shipped code might be tampered, it is important for NESAL to ship with tamper-proof or tamper-evident mechanism.</p>
<p>Java provides tools and methods to digitally sign JAR files.</p>
<p>To summarize digital signing:</p>
<ul>
<li>The signer signs the JAR file using a private key.</li>
<li>The corresponding public key is placed in the JAR file, together with its certificate (issued by CA), so that it is available for use by anyone who wants to verify the signature.</li></ul>
<p>To verify the signing at runing:</p>
<ul>
<li>Signed code invoked with the -jar option of the Java interpreter will be verified by the JVM. If the the verification fails due to code being tampered, an error message is displayed. For example, if the contents of a JAR file have changed since the JAR file was signed, a message similar to the following will result if one try to execute the file:</li></ul>
<div class="source">
<pre>  jarsigner: java.lang.SecurityException: invalid SHA1 
  signature file digest for nesal/agent/classes/Manifest.class
</pre></div>
<p><br /></p>
<div class="section">
<h3>13) Choosing a Logging Framework Compatible with Various Runtime<a name="a13_Choosing_a_Logging_Framework_Compatible_with_Various_Runtime"></a></h3></div>
<p>For example, consider using SLF4J (<a class="externalLink" href="http://www.slf4j.org/">http://www.slf4j.org/</a>) as a facade and allows the application to plug in their desired logging framework (Log4J, java.util.logging, etc) at runtime.</p>
<p><br /></p>
<div class="section">
<h3>14) Establish Clear Conventions for Versioning<a name="a14_Establish_Clear_Conventions_for_Versioning"></a></h3></div>
<p>The following decision will need to be made:</p>
<ul>
<li>Will the API uses version for future extension, or will it be completely versionless? To achieve versionless, significant discipline and foresight will be required.</li></ul>
<ul>
<li>For an API to be completely stable is actually rare. Change is often inevitable. What's important is how that change is managed. Well documented and announced multi-month deprecation schedules can be an acceptable practice for many APIs. It comes down to what is reasonable given the possible consumers of the API.</li></ul>
<ul>
<li>For RESTful API, should the URI contain a version number, or should that be a parameter? In the absence of either, which version should be delivered?</li></ul>
<p><br /></p>
<div class="section">
<h3>15) Documentation of API<a name="a15_Documentation_of_API"></a></h3></div>
<p>The API documents for each supported programming language should conform to the language's convention, for example, Javadoc for Java API and RubyDoc for Ruby API.</p>
<p><br /></p>
<div class="section">
<h3>16) Messaging Mechanism to Backend<a name="a16_Messaging_Mechanism_to_Backend"></a></h3></div>
<ul>
<li>The format of essages sent from NESAL to Smart Call Home will conform the that used by current Embedded Agent.</li></ul>
<ul>
<li>The transport mechanism will utilize a customized Java version of Call-Home Client library that will be provided by Call-Home team.</li></ul>
<p><br /></p>
<div class="section">
<h3>17) Reuse of Test Suite from the Embedded Agent<a name="a17_Reuse_of_Test_Suite_from_the_Embedded_Agent"></a></h3></div>
<p>It is possible to reuse the test suite developed for the Embedded Agent. Some customization may be required to convert current test script to Java JUnit code. Another possibility is for NESAL to provide IOS CLI emulator which provide similar CLI interface for accessing NESAL services. With such CLI emulator, the test suite can be re-used with even less customization.</p>
<p><br /></p>
<div class="section">
<h3>18) Code Commit Process<a name="a18_Code_Commit_Process"></a></h3></div>
<p>The code commit process will be strictly followed in the developmnt phase of NESAL. To summarize the process, developers need to follow these:</p>
<ul>
<li>The developer runs unit tests and static analysis on the code that they have added or changed.</li>
<li>If no unit test code exists to test the change, the developer should write new test code to cover the changes.</li>
<li>Unit Test should contain at least one positive case and one negative case. For more complicated features, the unit test plan should be defined during iteration planning to determine the required test cases.</li>
<li>Unit test code should follow usage guideline of the selected tools so the test code can be run under the same framework.</li>
<li>Before code commit, the developer submits the request to review the code and gets the approval.</li></ul>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
